<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>A scaffolded ASP.Identity + MVC5 code gotcha</title>
    <meta name="description" content="Headphone wearing computer typer">
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="//bootswatch.com/yeti/bootstrap.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="canonical" href="/2014/11/03/asp5ident.textile">
    <script src="/js/jquery.zrssfeed.js"></script>
    <link rel="stylesheet" href="/css/site.css">
</head>


  <body>
  	<div class="container">
		<div class="row" id="header">
    		<nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><i class="fa fa-home fa-lg"></i></a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
      
          
          <li><a href="/about/">About</a></li>
          
        
          
        
          
        
          
        
      </ul>				         
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
		</div>
    	<div class="row" id="maincontent">
        	<div class="post">
  <header class="post-header">
	<div class="col-sm-12">
    <h1 class="post-title" style="margin-bottom:.1em;">A scaffolded ASP.Identity + MVC5 code gotcha</h1>
    <p class="post-meta lead">Nov 3, 2014 | Zacharias</p>
	</div>
  </header>
	<div class="container">
    	p. _The setup: You scaffold code for WS-Federation for MVC 5 using the Visual Studio 2013 tooling. Then everything stops working when you move that code off of your laptop. What happened?_

p. So, you got started with a federated identity provider on your new ASP.net project and everything's working great, until it gets published to the dev server. Then, nothing works! This can be "super frustrating":http://stackoverflow.com/questions/10324627/url-redirection-from-adfs-server/ if it happens to you. 

h4. You too can even!

p. Some of the pre generated/scaffolded code you got when filling out sets a reply URL:

@<wsFederation passiveRedirectEnabled="true" issuer="https://myissuer/adfs/ls/" realm="https://localhost:44302" requireHttps="true" reply="https://localhost:44302" />@

There's three possible outcomes involved with the reply item in the @wsFederation@ line in your @web.config@:

# If there isn't a reply url set, the RP (on the ADFS box) will redirect to the default URL for redirect.
# If you set a reply url that isn't on the list of redirect urls in the RP you'll get an error or a default redirect, depending on some other settings
# If you have a reply url set that isn't the default RP redirect URL AND that url is on the list of redirect urls on the RP, you get redirected to that url.

p. Since you are a responsible programmer, you won't do this, right?

@<!-- <wsFederation passiveRedirectEnabled="true" issuer="https://myissuer/adfs/ls/" realm="https://localhost:44302" requireHttps="true" reply="https://localhost:44302" /> -->@
@<wsFederation passiveRedirectEnabled="true" issuer="https://myissuer/adfs/ls/" realm="https://localhost:44302" requireHttps="true" reply="https://mydevelopmentserver:44302" />@

"Use a XML transform":http://msdn.microsoft.com/en-us/library/vstudio/dd465318(v=vs.100).aspx to automate configuration to work with development.

* "WSFederation Authentication Module Overview":http://msdn.microsoft.com/en-us/library/jj191638(v=vs.110).aspx
	</div>
</div>

        </div>
    	<div class="row" id="footer">  
       		<div class="row footer-row" style="padding-top:1em; padding-bottom:1em; margin-left:0; margin-right:0; border-top:10px #878787">
	<div class="col-md-4">
		<p>Zacharias Stankiewicz<br />
		<small>Headphone wearing computer typer</small></p>
		<p class="rss-subscribe"><a href="/feed.xml"><i class="fa fa-rss"></i> subscribe to posts via RSS</a></p>
		<ul class="list-unstyled">
			<li><i class="fa fa-envelope-o"></i> <a href="mailto:zacharias.stankiewicz@gmail.com">zacharias.stankiewicz@gmail.com</a></li>
			
			<li><i class="fa fa-github-alt"></i> <a href="https://github.com/zacharias"> zacharias</a></li>
			
			
			<li><i class="fa fa-linkedin"></i> <a href="https://www.linkedin.com/pub/zacharias-stankiewicz/50/350/aaa"> Zacharias Stankiewicz</a></li>
			
			
			<li><i class="fa fa-square-o"></i> <a href="https://about.me/zacharias"> zacharias</a></li>
			
			
			<li><i class="fa fa-twitter"></i> <a href="https://twitter.com/zachstankiewicz"> @zachstankiewicz</a></li>
			
			
			<li><i class="fa fa-google-plus-square"></i> <a href="https://plus.google.com/+ZachariasStankiewicz"> +ZachariasStankiewicz</a></li>
			
		</ul>
	</div>
	<div class="col-md-8" id="rssbox" style="font-size:.9em;">
		<!-- JS below is making that happen for me. -->
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function () {
		$('#rssbox').rssfeed('https://www.instapaper.com/archive/rss/2140502/gJarrcxzUUjxTGAE7n0rRoEo4Ho', {
		limit: 10
		});
	});
</script>
    	</div>
  </body>
</html>
